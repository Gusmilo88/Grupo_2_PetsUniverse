<!DOCTYPE html>
<html lang="en">
    <%- include('./partials/head')%>
<body class="edit__body">
    
    <%- include('./partials/header')%>

    <main class="edit__main">
        <div class="edit__main__div">
            <h3>Agregar Producto:</h3>
            <form method="POST"  enctype="multipart/form-data" id="form-product-create">
                <div class="edit__main__div--info">
                    <div class="edit__div__div--2">
                        <label for="name">Nombre del producto:</label>
                        <input type="text" id="name" name="name" value="" autofocus>
                        <p class="errorInput" id="nameError"><%= locals.errors && errors.name ? errors.name.msg : null %></p>
                    </div>
                    <div class="edit__div__div--2">
                        <label for="description">Descripción:</label>
                        <textarea id="description" name="description" value=""> </textarea>
                        <p class="errorInput" id="descriptionError"><%= locals.errors && errors.description ? errors.description.msg : null %></p>
                    </div>
                    <div class="edit__div__div">
                        <div class="edit__div__div--2">
                            <label for="category">Categoría:</label>
                            <select name="category" id="category" value="">
                                <option value="" selected hidden>Seleccione...</option>
                                <% categories.forEach(({name, id}) => { %>
                                 <option value="<%= id %>" <%= locals.old && old.category && old.category === name ? 'selected' : null %>><%= name %></option>
                                <% }) %>
                                
                            </select>
                            <p class="errorInput" id="categoryError"><%= locals.errors && errors.category ? errors.category.msg : null %></p>
                        </div>
                        <div class="edit__div__div--2">
                            <label for="productType">Tipo de producto:</label>
                            <select name="productType" id="productType">
                                <option value="" selected hidden>Seleccione...</option>
                                <% productoTipo.forEach(({name, id}) => { %>
                                 <option value="<%= id %>" <%= locals.old && old.productType && old.productType === name ? 'selected' : null %>><%= name %></option>
                                <% }) %>
                                
                            </select>
                            <p class="errorInput" id="productTypeError"><%= locals.errors && errors.productType ? errors.productType.msg : null %></p>
                        </div> 
                    </div>
                    <div class="edit__div__div">
                       <div class="edit__div__div--2">
                            <label for="price">Precio:</label>
                            <input type="number" id="price" name="price" value="">
                            <p class="errorInput" id="priceError"><%= locals.errors && errors.price ? errors.price.msg : null %></p>
                            
                        </div>
                        
                        <div class="edit__div__div--2">
                            <label for="weight">Descuento:</label>
                            <input type="number" id="discount" name="discount" value="">
                            <p class="errorInput" id="discountError"><%= locals.errors && errors.discount ? errors.discount.msg : null %></p>
                        </div> 
                        <div class="edit__div__div--2">
                            <label for="weight">Peso:</label>
                            <input type="number" id="weight" name="weight" value="">
                            <p class="errorInput" id="weightError"></p> <!-- El peso no lo hacemos obligatorio -->
                        </div> 
                        <div class="edit__div__div--2">
                            <label for="stock">Stock:</label>
                            <input type="number" id="stock" name="stock" value="">
                            <p class="errorInput" id="stockError"><%= locals.errors && errors.stock ? errors.stock.msg : null %></p>
                        </div> 
                    </div>
                    <div class="edit__div__div">
                       <div class="edit__div__div--2">
                            <label for="images">Imagen:</label>
                            <input type="file" class="form-image" id="images" name="images" multiple value="">
                            <p class="errorInput" id="imagesError"><%= locals.errors && errors.images ? errors.images.msg : null %></p>
                        </div>
                    </div>
                <div class="edit__div__div--button">
                    <div class="edit__main__div--button">
                        <button onclick="window.location.href='/productEdit'">Cancelar cambios</button>
                    </div>
                    <div class="edit__main__div--button">
                        <button type="submit">Guardar cambios</button>
                    </div> 
                </div>    
                
            </form>
        </div>
    </main>
    <%- include('./partials/footer')%>

    

    <%- include('./partials/scripts')%>


    <!--<script src="/javascripts/productCreate.js"></script> -->

    <script>
        
        /* capturar elementos del formulario */
        const $ = id => document.getElementById(id)
        const productCreate = $('form-product-create')
        const inputName = $('name');
        const textAreaDescription = $('description');
        const selectCategory = $('category');
        const inputproductType = $('productType');
        const inputPrice = $('price');
        const inputDiscount = $('discount') ;
        // const inputweight = $('weight'); //El peso no es obligatorio
        const inputStock = $('stock');
        const inputImages = $('images');

        


        inputName.addEventListener('blur', function(){
            switch (true) {
                case !this.value.trim():
                    $('nameError').innerHTML = "El nombre del producto es obligatorio"
                    this.classList.add('nameError')
                    break;
                    case this.value.trim().length < 5:
                    $('nameError').innerHTML = "El nombre debe tener mínimo 5 carácteres"          
            break;
            
                default:

                    break;
            }
        })

        inputName.addEventListener('focus', function(){
            this.classList.remove('nameError')
            $('nameError').innerHTML = null
        })

        inputPrice.addEventListener('blur', function(){
            switch (true) {
                case !this.value.trim():
                    $('priceError').innerHTML = "El precio del producto es obligatorio"
                    this.classList.add('priceError')
                    break;
            
                default:
                    break;
            }
        })
        inputPrice.addEventListener('focus', function(){
            this.classList.remove('priceError')
            $('priceError').innerHTML = null
        })

        textAreaDescription.addEventListener('blur', function(){
            switch (true) {
                case !this.value.trim():
                    $('descriptionError').innerHTML = "La descripción del producto es obligatoria"
                    this.classList.add('descriptionError')
                    break;
                    case this.value.trim().length < 20:
                    $('descriptionError').innerHTML = "El nombre debe tener mínimo 20 carácteres"
            
                default:
                    break;
            }
        })
        textAreaDescription.addEventListener('focus', function(){
            this.classList.remove('descriptionError')
            $('descriptionError').innerHTML = null
        })

        selectCategory.addEventListener('blur', function(){
            switch (true) {
                case !this.value.trim():
                    $('categoryError').innerHTML = "La categoria del producto es obligatoria"
                    this.classList.add('categoryError')
                    break;
            
                default:
                    break;
            }
        })
        selectCategory.addEventListener('focus', function(){
            this.classList.remove('categoryError')
            $('categoryError').innerHTML = null
        })

        inputproductType.addEventListener('blur', function(){
            switch (true) {
                case !this.value.trim():
                    $('productTypeError').innerHTML = "el tipo del producto es obligatoria"
                    this.classList.add('productTypeError')
                    break;
            
                default:
                    break;
            }
        })
        inputproductType.addEventListener('focus', function(){
            this.classList.remove('productTypeError')
            $('productTypeError').innerHTML = null
        })

        
        inputDiscount.addEventListener('blur', function(){
            switch (true) {
                case !this.value.trim():
                    $('discountError').innerHTML = "El descuento del producto es obligatorio"
                    this.classList.add('discountError')
                    break;
            
                default:
                    break;
            }
        })
        inputDiscount.addEventListener('focus', function(){
            this.classList.remove('discountError')
            $('discountError').innerHTML = null
        })

        
        inputDiscount.addEventListener('blur', function(){
            switch (true) {
                case !this.value.trim():
                    $('Error').innerHTML = "El nombre del producto es obligatorio"
                    break;
            
                default:
                    break;
            }
        })


        //El peso no es obligatorio
        // inputweight.addEventListener('blur', function(){
        //     switch (true) {
        //         case !this.value.trim():
        //             $('weightError').innerHTML = "El peso del producto es obligatorio"
        //             this.classList.add('wightError')
        //             break;
            
        //         default:
        //             break;
        //     }
        // })
        // inputweight.addEventListener('focus', function(){
        //     this.classList.remove('weightError')
        //     $('weightError').innerHTML = null
        // })

        
        inputStock.addEventListener('blur', function(){
            switch (true) {
                case !this.value.trim():
                    $('stockError').innerHTML = "El stock del producto es obligatorio"
                    this.classList.add('stockError')
                    break;
            
                default:
                    break;
            }
        })
        inputStock.addEventListener('focus', function(){
            this.classList.remove('stockError')
            $('stockError').innerHTML = null
        })

        const regExExt = /(.jpg|.jpeg|.png|.gif|.webp)$/i;
        inputImages.addEventListener('blur', function(){
            switch (true) {
                case !this.value.trim():
                    $('imagesError').innerHTML = "La imagen del producto es obligatoria"
                    this.classList.add('imagesError')
                    break;
                    case !regExExt.exec(this.value):
            $("imagesError").innerHTML = "Solo se admiten imágenes jpg, jpeg, png, gif, webp"
            break;
            
                default:
                    break;

            }
        })
        inputImages.addEventListener('focus', function(){
            this.classList.remove('imagesError')
            $('imagesError').innerHTML = null
        })

        
        


        console.log(productCreate);


    </script>
</body>
</html>
